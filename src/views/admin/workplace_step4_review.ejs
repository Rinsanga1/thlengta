<header class="nav">
  <div class="container nav-inner">
    <div class="brand">
      <span>
        <img src="/assets/img/thlengtalogo.png" alt="Thlengta logo" width="80px"/>
      </span>
      <span class="small">
        <img src="/assets/img/thlengtalogotext.png" alt="Thlengta logo type" width="195px"/>
      </span>
      <span class="small">
        <img src="/assets/img/com.png" alt="Thlengta logo type" width="75px" style="margin-left: -10px"/>
      </span>
    </div>
    <nav class="nav-links">
      <a class="btn" href="/admin/workplace/new/step-3">Back</a>
    </nav>
  </div>
</header>

<section class="section" style="padding-top:46px;">
  <div class="card pad super" style="max-width:980px;margin:0 auto;">
    <div class="topbar" style="margin-bottom:14px;">
      <div>
        <div class="h-eyebrow">
          <span class="chip">Workplace</span>
          <span class="chip">Setup</span>
          <span class="chip">Step 4 of 4</span>
        </div>
        <h2 style="margin:10px 0 0;">Review and create</h2>
        <div class="small" style="margin-top:6px;">
          Confirm everything before generating the QR.
        </div>
      </div>
    </div>

    <% if (error) { %>
      <div class="error"><%= error %></div>
    <% } %>

    <div class="card pad" style="background:#fff;">
      <h3 style="margin:0 0 10px;">Summary</h3>

      <!-- Summary grid: 3-up on desktop, stacks on mobile -->
      <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:14px;">
        <div class="notice">
          <div style="font-weight:900;">Name</div>
          <div class="small" style="margin-top:6px;"><%= draft && draft.name ? draft.name : "-" %></div>
        </div>

        <div class="notice">
          <div style="font-weight:900;">Opening</div>
          <div class="small" style="margin-top:6px;"><%= draft && draft.opening_time_12 ? draft.opening_time_12 : "-" %></div>
        </div>

        <div class="notice">
          <div style="font-weight:900;">Closing</div>
          <div class="small" style="margin-top:6px;"><%= draft && draft.closing_time_12 ? draft.closing_time_12 : "-" %></div>
        </div>
      </div>

      <div style="height:10px;"></div>

      <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:14px;">
        <div class="notice">
          <div style="font-weight:900;">Latitude</div>
          <div class="small" style="margin-top:6px;"><%= (draft && draft.lat !== undefined) ? Number(draft.lat).toFixed(6) : "-" %></div>
        </div>

        <div class="notice">
          <div style="font-weight:900;">Longitude</div>
          <div class="small" style="margin-top:6px;"><%= (draft && draft.lng !== undefined) ? Number(draft.lng).toFixed(6) : "-" %></div>
        </div>

        <div class="notice" style="background:#eaf6f0;">
          <div style="font-weight:900;">Radius</div>
          <div class="small" style="margin-top:6px;"><%= (draft && draft.radius_m) ? draft.radius_m : 70 %> meters</div>
        </div>
      </div>

      <div class="notice" style="margin-top:12px; background:#fff7df;">
        <div style="font-weight:900;">Final check</div>
        <div class="small" style="margin-top:6px;">
          If your staff will scan indoors, donâ€™t set the radius too tight. You can edit settings later.
        </div>
      </div>

      <div style="height:12px;"></div>

      <h3 style="margin:0 0 10px;">Map preview</h3>
      <div style="border:1px solid var(--border); border-radius:12px; overflow:hidden;">
        <iframe
          title="Map preview"
          width="100%"
          height="320"
          style="border:0;display:block;"
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
          src="https://www.google.com/maps?q=<%= encodeURIComponent(String(draft.lat || '0') + ',' + String(draft.lng || '0')) %>&z=18&output=embed"
        ></iframe>
      </div>

      <div class="actions" style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
        <form method="post" action="/admin/workplace/new/finish" style="margin:0;">
          <button class="btn primary" type="submit" style="width:auto;">
            Create workplace and generate QR
          </button>
        </form>

        <a class="btn" href="/admin/workplace/new/step-3" style="width:auto;">Back</a>
      </div>

      <div class="small" style="margin-top:10px;">
        After creation, you will be taken to the QR page.
      </div>

      <!-- Mobile stack styles -->
      <style>
        @media (max-width: 820px){
          /* Summary cards stack */
          .card.pad.super .card.pad[style*="background:#fff;"] > div[style*="grid-template-columns: 1fr 1fr 1fr"]{
            grid-template-columns: 1fr !important;
          }
          /* Map slightly taller on mobile */
          iframe[title="Map preview"]{ height: 360px; }
        }
      </style>
    </div>
  </div>
</section>
