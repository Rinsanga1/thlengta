<section class="section" style="padding-top:46px;">
  <div style="max-width:1100px;margin:0 auto 20px;">
    <a class="btn" href="/owner/dashboard" style="width:auto;">← Back to Dashboard</a>
  </div>
  <div class="card pad super" style="margin:0 auto;">
    <div class="topbar" style="margin-bottom:14px;">
      <div>
        <div class="h-eyebrow">
          <span class="chip">Employees</span>
          <span class="chip">Manage</span>
        </div>
        <h2 style="margin:10px 0 0;">Employees</h2>
        <div class="small" style="margin-top:6px;">
          Workplace: <b><%= workplace.name %></b>
        </div>
      </div>
    </div>

    <% if (typeof msg !== "undefined" && msg) { %>
      <div class="notice" style="margin:12px 0;">
        <div style="font-weight:900;">Done</div>
        <div class="small"><%= msg %></div>
      </div>
    <% } %>

    <div class="actions" style="margin:12px 0 8px;">
      <a class="btn" href="/owner/workplaces/<%= workplace.id %>/">View QR</a>
      <a class="btn primary" href="/owner/workplaces/<%= workplace.id %>/employees/new">Add Employee</a>
    </div>

    <div class="notice" style="margin:10px 0 16px;">
      <div style="font-weight:900;">Device rule</div>
      <div class="small">
        Each employee can register on 1 device only. Use “Reset Device” if they changed phone.
      </div>
    </div>

    <% if (!employees.length) { %>
      <div class="card pad" style="background:#f8faf9;">
        <div style="font-weight:900;">No employees yet</div>
        <div class="small" style="margin-top:6px;">Add your first employee to enable check-in.</div>
        <div class="actions" style="margin-top:12px;">
          <a class="btn primary" href="/owner/workplaces/<%= workplace.id %>/employees/new">Add Employee</a>
        </div>
      </div>
    <% } else { %>

      <div style="overflow:auto;">
        <table style="width:100%; border-collapse:collapse;">
          <thead>
            <tr>
              <th style="text-align:left; padding:12px; border-bottom:2px solid rgba(0,0,0,0.12);">Email</th>
              <th style="text-align:left; padding:12px; border-bottom:2px solid rgba(0,0,0,0.12);">Status</th>
              <th style="text-align:left; padding:12px; border-bottom:2px solid rgba(0,0,0,0.12);">Device</th>
              <th style="text-align:left; padding:12px; border-bottom:2px solid rgba(0,0,0,0.12);">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% employees.forEach(e => { %>
              <tr>
                <td style="padding:12px; border-bottom:1px solid rgba(0,0,0,0.08);">
                  <div style="font-weight:800;"><%= e.email %></div>
                </td>

                <td style="padding:12px; border-bottom:1px solid rgba(0,0,0,0.08);">
                  <% if (e.is_active) { %>
                    <span class="badge"><span class="dot"></span> Active</span>
                  <% } else { %>
                    <span class="badge" style="background:#fff1f1;"><span class="dot" style="background:#d64545;"></span> Disabled</span>
                  <% } %>
                </td>

                <td style="padding:12px; border-bottom:1px solid rgba(0,0,0,0.08);">
                  <% if (e.device_registered) { %>
                    <span class="badge" style="background:#eaf6f0;"><span class="dot"></span> Registered</span>
                  <% } else { %>
                    <span class="small">Not registered</span>
                  <% } %>
                </td>

                <td style="padding:12px; border-bottom:1px solid rgba(0,0,0,0.08); white-space:nowrap;">
                  <div class="actions" style="gap:8px; margin:0;">
                    <form method="post" action="/owner/workplaces/<%= workplace.id %>/employees/<%= e.id %>/toggle" style="display:inline;">
                      <button type="submit" style="width:auto; margin:0;">
                        <%= e.is_active ? "Disable" : "Enable" %>
                      </button>
                    </form>

                    <% if (e.is_active && e.device_registered) { %>
                      <form
                        method="post"
                        action="/owner/workplaces/<%= workplace.id %>/employees/<%= e.id %>/device/reset"
                        style="display:inline; margin:0;"
                        onsubmit="return confirm('Reset device for this employee? They will need email + PIN again on a new phone.');"
                      >
                        <button type="submit" style="width:auto; margin:0;">
                          Reset Device
                        </button>
                      </form>
                    <% } %>

                    <form
                      method="post"
                      action="/owner/workplaces/<%= workplace.id %>/employees/<%= e.id %>/delete"
                      style="display:inline; margin:0;"
                      onsubmit="return confirm('Delete this employee? This cannot be undone.');"
                    >
                      <button type="submit" style="width:auto; margin:0; background:#fff1f1;">
                        Delete
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>
</section>
