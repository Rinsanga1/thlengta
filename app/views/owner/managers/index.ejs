<header class="nav">
  <div class="container nav-inner">
    <div class="brand">
      <span>
        <img src="/assets/img/thlengtalogo.png" alt="Thlengta logo" width="80px"/>
      </span>
      <span class="small">
        <img src="/assets/img/thlengtalogotext.png" alt="Thlengta logo type" width="195px"/>
      </span>
      <span class="small">
        <img src="/assets/img/com.png" alt="Thlengta logo type" width="75px" style="margin-left: -10px"/>
      </span>
    </div>

    <nav class="nav-links">
      <a class="btn" href="/owner/dashboard">Back</a>
    </nav>
  </div>
</header>

<%
  // Safe defaults to prevent "undefined" crashes
  const _msg = (typeof msg !== "undefined") ? msg : null;
  const _alertType = (typeof alertType !== "undefined" && alertType) ? String(alertType) : null; // "success" | "error"
  const _enterpriseOnly = (typeof enterpriseOnly !== "undefined") ? enterpriseOnly : false;
%>

<section class="section" style="padding-top:46px;">
  <div class="card pad super" style="margin:0 auto;">
    <div class="topbar" style="margin-bottom:14px;">
      <div>
        <div class="h-eyebrow">
          <span class="chip">Managers</span>
          <span class="chip">Manage</span>
        </div>

        <h2 style="margin:10px 0 0;">Managers</h2>
        <div class="small" style="margin-top:6px;">
          Store: <b><%= store.name %></b>
        </div>
      </div>
    </div>

    <% if (_msg && _alertType) { %>
      <div class="<%= _alertType === 'success' ? 'notice' : 'error' %>" style="margin:12px 0;">
        <div style="font-weight:900;">
          <%= _alertType === 'success' ? 'Successful!' : 'Oh Biscuits!' %>
        </div>
        <div class="small" style="margin-top:6px;"><%= _msg %></div>
      </div>
    <% } %>

    <% if (_enterpriseOnly) { %>
      <div class="notice">Managers are available only on Enterprise plan. Upgrade to gain this useful feature!</div>

      <div class="actions" style="margin-top:12px;">
        <a class="btn" href="/owner/dashboard">Back</a>
      </div>
    <% } else { %>

      <div class="actions" style="margin:12px 0 8px;">
        <a class="btn primary" href="/owner/stores/<%= store.id %>/managers/new">Add Manager</a>
      </div>

      <div class="notice" style="margin:10px 0 16px;">
        <div style="font-weight:900;">Access scope</div>
        <div class="small">
          Managers can only access stores they are assigned to. They cannot edit store settings.
        </div>
      </div>

      <% if (!managers || managers.length === 0) { %>
        <div class="card pad" style="background:#f8faf9;">
          <div style="font-weight:900;">No managers assigned yet</div>
          <div class="small" style="margin-top:6px;">
            Add a manager to help monitor attendance and manage employees for this store.
          </div>
          <div class="actions" style="margin-top:12px;">
            <a class="btn primary" href="/owner/stores/<%= store.id %>/managers/new">Add Manager</a>
          </div>
        </div>
      <% } else { %>

        <div style="overflow:auto;">
          <table style="width:100%; border-collapse:collapse;">
            <thead>
              <tr>
                <th style="text-align:left; padding:12px; border-bottom:2px solid rgba(0,0,0,0.12);">Email</th>
                <th style="text-align:left; padding:12px; border-bottom:2px solid rgba(0,0,0,0.12);">Status</th>
                <th style="text-align:left; padding:12px; border-bottom:2px solid rgba(0,0,0,0.12);">Actions</th>
              </tr>
            </thead>

            <tbody>
              <% managers.forEach((m) => { %>
                <tr>
                  <td style="padding:12px; border-bottom:1px solid rgba(0,0,0,0.08);">
                    <div style="font-weight:800;"><%= m.email %></div>
                  </td>

                  <td style="padding:12px; border-bottom:1px solid rgba(0,0,0,0.08);">
                    <% if (m.is_active) { %>
                      <span class="badge"><span class="dot"></span> Active</span>
                    <% } else { %>
                      <span class="badge" style="background:#fff1f1;">
                        <span class="dot" style="background:#d64545;"></span> Disabled
                      </span>
                    <% } %>
                  </td>

                  <td style="padding:12px; border-bottom:1px solid rgba(0,0,0,0.08); white-space:nowrap;">
                    <div class="actions" style="gap:8px; margin:0;">
                      <form method="post" action="/owner/stores/<%= store.id %>/managers/<%= m.id %>/toggle" style="display:inline; margin:0;">
                        <button type="submit" style="width:auto; margin:0;">
                          <%= m.is_active ? "Disable" : "Enable" %>
                        </button>
                      </form>

                      <form
                        method="post"
                        action="/owner/stores/<%= store.id %>/managers/<%= m.id %>/remove"
                        style="display:inline; margin:0;"
                        onsubmit="return confirm('Remove this manager from this store?');"
                      >
                        <button type="submit" style="width:auto; margin:0; background:#fff1f1;">
                          Remove
                        </button>
                      </form>
                    </div>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>

      <% } %>
    <% } %>
  </div>
</section>
