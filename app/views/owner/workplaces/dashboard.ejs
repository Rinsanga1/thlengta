<section class="section" style="padding-top:20px;">
  <!-- Back Button -->
  <div style="max-width:1200px;margin:0 auto 15px;">
    <a class="btn" href="/owner/dashboard" style="width:auto;">← Back to Dashboard</a>
  </div>

  <!-- Workplace Header -->
  <div class="card" style="max-width:1200px;margin:0 auto 20px;padding:20px;">
    <div style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:15px;">
      <div>
        <h2 style="margin:0;"><%= workplace.name %></h2>
        <div class="small" style="margin-top:4px;">
          <% if (workplace.address) { %><%= workplace.address %> · <% } %>
          <%= workplace.open_time || '--:--' %> - <%= workplace.close_time || '--:--' %>
        </div>
      </div>
    </div>
  </div>

  <!-- Dashboard with Left Sidebar Tabs -->
  <div class="card" style="max-width:1200px;margin:0 auto;padding:0;">
    <div class="dashboard-layout" style="display:flex; min-height:500px;">
      <!-- Left Sidebar Tabs -->
      <div class="tab-sidebar" style="width:180px; border-right:1px solid var(--border); background:#fafafa; flex-shrink:0;">
        <a href="/owner/workplaces/<%= workplace.id %>?tab=checkin" 
           class="tab<%= activeTab === 'checkin' ? ' active' : '' %>">Check-In</a>
        <a href="/owner/workplaces/<%= workplace.id %>?tab=logs" 
           class="tab<%= activeTab === 'logs' ? ' active' : '' %>">Logs</a>
        <a href="/owner/workplaces/<%= workplace.id %>?tab=employees" 
           class="tab<%= activeTab === 'employees' ? ' active' : '' %>">Employees</a>
        <% if (isEnterprise) { %>
        <a href="/owner/workplaces/<%= workplace.id %>?tab=managers" 
           class="tab<%= activeTab === 'managers' ? ' active' : '' %>">Managers</a>
        <% } %>
        <a href="/owner/workplaces/<%= workplace.id %>?tab=settings" 
           class="tab<%= activeTab === 'settings' ? ' active' : '' %>">Settings</a>
      </div>

      <!-- Tab Content -->
      <div class="tab-content" style="flex:1; padding:20px; min-width:0;">
      
      <% if (msg) { %>
        <div class="notice" style="background:#eaf6f0; margin-bottom:15px;"><%= msg %></div>
      <% } %>

      <!-- CHECK-IN TAB -->
      <% if (activeTab === 'checkin') { %>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px;">
          <h3 style="margin:0;">Today's Check-In</h3>
          <span class="small muted"><%= new Date().toLocaleDateString('en-GB', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' }) %></span>
        </div>

        <% if (!checkinData.length) { %>
          <div class="muted">No active employees yet.</div>
        <% } else { %>
          <div style="overflow-x:auto;">
            <table style="width:100%; border-collapse:collapse;">
              <thead>
                <tr style="border-bottom:2px solid var(--border);">
                  <th style="text-align:left; padding:10px;">Employee</th>
                  <th style="text-align:left; padding:10px;">Status</th>
                  <th style="text-align:left; padding:10px;">Time</th>
                </tr>
              </thead>
              <tbody>
                <% checkinData.forEach(emp => { 
                  // Format time to 12-hour
                  let time12 = '-';
                  if (emp.checkin_time) {
                    const timePart = emp.checkin_time.split(' ')[1];
                    if (timePart) {
                      const [hours, minutes] = timePart.split(':').map(Number);
                      const period = hours >= 12 ? 'pm' : 'am';
                      const hours12 = hours % 12 || 12;
                      time12 = hours12 + ':' + String(minutes).padStart(2, '0') + ' ' + period;
                    }
                  }
                %>
                <tr style="border-bottom:1px solid var(--border);">
                  <td style="padding:10px;"><%= emp.email %></td>
                  <td style="padding:10px;">
                    <% if (emp.has_checked_in) { %>
                      <span class="chip" style="background:#e8f5e9;">Checked In</span>
                    <% } else { %>
                      <span class="chip" style="background:#fff3e0;">Not Checked In</span>
                    <% } %>
                  </td>
                  <td style="padding:10px;"><%= time12 %></td>
                </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } %>
      <% } %>

      <!-- EMPLOYEES TAB -->
      <% if (activeTab === 'employees') { %>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px;">
          <h3 style="margin:0;">Employees (<%= employeeTotalItems %>)</h3>
          <button type="button" class="btn primary" id="addEmployeeBtn">+ Add Employee</button>
        </div>

        <% if (!employees.length) { %>
          <div class="muted">No employees yet. Add your first employee.</div>
        <% } else { %>
          <div style="overflow-x:auto;">
            <table style="width:100%; border-collapse:collapse;">
              <thead>
                <tr style="border-bottom:2px solid var(--border);">
                  <th style="text-align:left; padding:10px;">Email</th>
                  <th style="text-align:left; padding:10px;">Added</th>
                  <th style="text-align:center; padding:10px;">Device</th>
                  <th style="text-align:center; padding:10px;">Status</th>
                  <th style="text-align:right; padding:10px;">Actions</th>
                </tr>
              </thead>
              <tbody>
                <% employees.forEach(e => { %>
                <tr style="border-bottom:1px solid var(--border);">
                  <td style="padding:10px;"><%= e.email %></td>
                  <td style="padding:10px;" class="small"><%= e.created_at ? e.created_at.split(' ')[0] : '-' %></td>
                  <td style="padding:10px; text-align:center;">
                    <% if (e.has_device) { %>
                      <span class="chip" style="background:#eaf6f0;">Registered</span>
                    <% } else { %>
                      <span class="chip" style="background:#fff3e0;">Not set</span>
                    <% } %>
                  </td>
                  <td style="padding:10px; text-align:center;">
                    <% if (e.is_active) { %>
                      <span class="chip" style="background:#e8f5e9;">Active</span>
                    <% } else { %>
                      <span class="chip" style="background:#ffebee;">Inactive</span>
                    <% } %>
                  </td>
                  <td style="padding:10px; text-align:right;">
                    <button type="button" class="btn emp-edit-btn" style="padding:4px 8px; font-size:12px;" data-email="<%= e.email %>" data-active="<%= e.is_active %>" data-device="<%= e.has_device %>">Edit</button>
                  </td>
                </tr>
                <% }) %>
              </tbody>
            </table>
          </div>

          <% if (employeeTotalPages > 1) { %>
          <div style="display:flex; justify-content:center; align-items:center; gap:10px; margin-top:20px;">
            <% if (employeePage > 1) { %>
              <a class="btn" href="/owner/workplaces/<%= workplace.id %>?tab=employees&empPage=<%= employeePage - 1 %>">← Prev</a>
            <% } %>
            <span class="small muted">Page <%= employeePage %> of <%= employeeTotalPages %></span>
            <% if (employeePage < employeeTotalPages) { %>
              <a class="btn" href="/owner/workplaces/<%= workplace.id %>?tab=employees&empPage=<%= employeePage + 1 %>">Next →</a>
            <% } %>
          </div>
          <% } %>
        <% } %>
      <% } %>

      <!-- LOGS TAB -->
      <% if (activeTab === 'logs') { %>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px;">
          <h3 style="margin:0;">Recent Logs</h3>
          <div style="display:flex; gap:8px;">
            <% if (isFilterApplied) { %>
            <a class="btn" href="/owner/workplaces/<%= workplace.id %>?tab=logs">Back to Present</a>
            <% } %>
            <button class="btn" id="saveLogsBtn">Save Logs</button>
          </div>
        </div>

        <!-- Date Picker Modal -->
        <div id="datePickerModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
          <div class="card pad" style="background:#fff; max-width:400px; width:90%; margin:20px;">
            <h3 style="margin:0 0 20px;">Select Date</h3>
            
            <form method="get" action="/owner/workplaces/<%= workplace.id %>">
              <input type="hidden" name="tab" value="logs" />
              
              <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:10px; font-weight:500;">Choose a date:</label>
                <input type="date" name="date" id="pickerDateInput" value="<%= selectedDate %>" style="width:100%; padding:10px; border:1px solid var(--border); border-radius:8px; font-size:16px;" />
              </div>
              
              <div style="display:flex; gap:10px; justify-content:flex-end;">
                <button type="button" class="btn" id="cancelDatePickerBtn">Cancel</button>
                <button type="submit" class="btn primary">Select Date</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Date Navigation -->
        <div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-bottom:15px;">
          <% if (hasNextLogPage) { %>
            <a class="btn" href="/owner/workplaces/<%= workplace.id %>?tab=logs&logPage=<%= logPage + 1 %>" style="padding:4px 10px; font-size:13px;">← Older</a>
          <% } else { %>
            <button class="btn" disabled style="opacity:0.5; cursor:not-allowed; padding:4px 10px; font-size:13px;">← Older</button>
          <% } %>
          
          <button class="btn" id="datePickerBtn" style="font-weight:600; min-width:110px; text-align:center; background:#f8f9fa; padding:4px 10px; font-size:13px;">
            <%= logPage === 1 ? 'Today' : logPage === 2 ? 'Yesterday' : new Date(selectedDate).toLocaleDateString('en-GB', { weekday: 'short', day: '2-digit', month: 'short' }) %>
          </button>
          
          <% if (hasPrevLogPage) { %>
            <a class="btn" href="/owner/workplaces/<%= workplace.id %>?tab=logs&logPage=<%= logPage - 1 %>" style="padding:4px 10px; font-size:13px;">Newer →</a>
          <% } else { %>
            <button class="btn" disabled style="opacity:0.5; cursor:not-allowed; padding:4px 10px; font-size:13px;">Newer →</button>
          <% } %>
        </div>

        <!-- Save Logs Modal -->
        <div id="saveLogsModal" data-workplace-id="<%= workplace.id %>" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
          <div class="card pad" style="background:#fff; max-width:400px; width:90%; margin:20px;">
            <h3 style="margin:0 0 20px;">Save Logs</h3>
            
            <div style="margin-bottom:20px;">
              <label style="display:block; margin-bottom:10px; font-weight:500;">Select Period:</label>
              
              <div style="display:flex; flex-direction:column; gap:10px;">
                <label class="period-card" data-save-period="day">
                  <input type="radio" name="savePeriod" value="day" checked>
                  <div class="period-card-content">
                    <div class="period-title">Specific Day</div>
                    <div class="period-desc">Download logs from a single day</div>
                  </div>
                </label>
                
                <label class="period-card" data-save-period="month">
                  <input type="radio" name="savePeriod" value="month">
                  <div class="period-card-content">
                    <div class="period-title">Full Month</div>
                    <div class="period-desc">Download logs from an entire month</div>
                  </div>
                </label>
                
                <label class="period-card" data-save-period="year">
                  <input type="radio" name="savePeriod" value="year">
                  <div class="period-card-content">
                    <div class="period-title">Full Year</div>
                    <div class="period-desc">Download logs from an entire year</div>
                  </div>
                </label>
              </div>
            </div>
            
            <div id="dayInput" style="margin-bottom:20px;">
              <label style="display:block; margin-bottom:5px; font-weight:500;">Date</label>
              <input type="date" id="saveDateInput" value="<%= selectedDate %>" style="width:100%; padding:10px; border:1px solid var(--border); border-radius:8px;" />
            </div>
            
            <div id="monthInput" style="margin-bottom:20px; display:none;">
              <label style="display:block; margin-bottom:5px; font-weight:500;">Month</label>
              <input type="month" id="saveMonthInput" value="<%= selectedDate.slice(0,7) %>" style="width:100%; padding:10px; border:1px solid var(--border); border-radius:8px;" />
            </div>
            
            <div id="yearInput" style="margin-bottom:20px; display:none;">
              <label style="display:block; margin-bottom:5px; font-weight:500;">Year</label>
              <input type="number" id="saveYearInput" value="<%= selectedDate.slice(0,4) %>" min="2020" max="2030" style="width:100%; padding:10px; border:1px solid var(--border); border-radius:8px;" />
            </div>
            
            <div style="display:flex; gap:10px; justify-content:flex-end;">
              <button class="btn" id="cancelSaveLogsBtn">Cancel</button>
              <button class="btn primary" id="downloadLogsBtn">Download</button>
            </div>
          </div>
        </div>

        <% if (!logs.length) { %>
          <div class="muted">No check-ins recorded on <%= new Date(selectedDate).toLocaleDateString('en-GB', { weekday: 'long', day: '2-digit', month: '2-digit', year: '2-digit' }) %>.</div>
        <% } else { %>
          <div class="logs-list">
            <% 
            // Group logs by date
            const logsByDate = {};
            logs.forEach(l => {
              const dateKey = l.created_at_ist ? l.created_at_ist.split(' ')[0] : 'Unknown';
              if (!logsByDate[dateKey]) logsByDate[dateKey] = [];
              logsByDate[dateKey].push(l);
            });
            
            // Sort dates in descending order
            const sortedDates = Object.keys(logsByDate).sort().reverse();
            
            // Day names
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            sortedDates.forEach(dateKey => {
              const dateObj = new Date(dateKey);
              const dayName = dayNames[dateObj.getDay()] || 'Unknown';
              const formattedDate = dateObj.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: '2-digit' }).replace(/\//g, '/');
              
              // Check if this date is today
              const today = new Date();
              const isToday = dateObj.getDate() === today.getDate() && 
                              dateObj.getMonth() === today.getMonth() && 
                              dateObj.getFullYear() === today.getFullYear();
              const todayLabel = isToday ? ' ( Today )' : '';
            %>
              <div class="date-group" style="margin-bottom:20px;">
                <div class="date-header" style="background:#f5f5f5; padding:10px 15px; border-radius:8px; margin-bottom:10px; font-weight:600; color:var(--text);">
                  <%= dayName %> - <%= formattedDate %><%= todayLabel %>
                </div>
                <div class="logs-for-date">
                  <% logsByDate[dateKey].forEach(l => { 
                    // Format time to 12-hour
                    let time12 = '-';
                    if (l.created_at_ist) {
                      const timePart = l.created_at_ist.split(' ')[1];
                      if (timePart) {
                        const [hours, minutes] = timePart.split(':').map(Number);
                        const period = hours >= 12 ? 'pm' : 'am';
                        const hours12 = hours % 12 || 12;
                        time12 = hours12 + ':' + String(minutes).padStart(2, '0') + ' ' + period;
                      }
                    }
                    
                    // Get employee name from email
                    const employeeName = l.employee_email ? l.employee_email.split('@')[0] : 'Unknown';
                  %>
                    <div class="log-entry" style="display:flex; align-items:center; padding:10px 15px; border-bottom:1px solid var(--border); gap:20px;">
                      <div class="log-time" style="min-width:80px; font-weight:500;"><%= time12 %></div>
                      <div class="log-employee" style="flex:1;"><%= employeeName %></div>
                      <div class="log-event">
                        <% if (l.event_type === 'checkin') { %>
                          <span class="chip" style="background:#e8f5e9;">Check-in</span>
                        <% } else if (l.event_type === 'checkout') { %>
                          <span class="chip" style="background:#e3f2fd;">Check-out</span>
                        <% } else if (l.event_type === 'break_start') { %>
                          <span class="chip" style="background:#fff3e0;">Break</span>
                        <% } else if (l.event_type === 'break_end') { %>
                          <span class="chip" style="background:#f3e5f5;">Resume</span>
                        <% } else { %>
                          <span class="chip"><%= l.event_type %></span>
                        <% } %>
                      </div>
                      <div class="log-gps" style="min-width:30px; text-align:center;">
                        <% if (l.gps_ok) { %>
                          <span style="color:green;">✓</span>
                        <% } else { %>
                          <span style="color:red;">✗</span>
                        <% } %>
                      </div>
                    </div>
                  <% }) %>
                </div>
              </div>
            <% }) %>
          </div>
          
          <!-- Bottom Date Navigation -->
          <div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:15px; padding-top:15px; border-top:1px solid var(--border);">
            <% if (hasNextLogPage) { %>
              <a class="btn" href="/owner/workplaces/<%= workplace.id %>?tab=logs&logPage=<%= logPage + 1 %>" style="padding:4px 10px; font-size:13px;">← Older</a>
            <% } else { %>
              <button class="btn" disabled style="opacity:0.5; cursor:not-allowed; padding:4px 10px; font-size:13px;">← Older</button>
            <% } %>
            
            <span class="small" style="font-weight:600; min-width:110px; text-align:center; font-size:13px;">
              <%= logPage === 1 ? 'Today' : logPage === 2 ? 'Yesterday' : new Date(selectedDate).toLocaleDateString('en-GB', { weekday: 'short', day: '2-digit', month: 'short' }) %>
            </span>
            
            <% if (hasPrevLogPage) { %>
              <a class="btn" href="/owner/workplaces/<%= workplace.id %>?tab=logs&logPage=<%= logPage - 1 %>" style="padding:4px 10px; font-size:13px;">Newer →</a>
            <% } else { %>
              <button class="btn" disabled style="opacity:0.5; cursor:not-allowed; padding:4px 10px; font-size:13px;">Newer →</button>
            <% } %>
          </div>
        <% } %>
      <% } %>

      <!-- MANAGERS TAB -->
      <% if (activeTab === 'managers') { %>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px;">
          <h3 style="margin:0;">Managers</h3>
          <a class="btn primary" href="/owner/workplaces/<%= workplace.id %>/managers/new">+ Add Manager</a>
        </div>

        <% if (!managers.length) { %>
          <div class="muted">No managers assigned. Managers can help manage this workplace.</div>
        <% } else { %>
          <div style="overflow-x:auto;">
            <table style="width:100%; border-collapse:collapse;">
              <thead>
                <tr style="border-bottom:2px solid var(--border);">
                  <th style="text-align:left; padding:10px;">Email</th>
                  <th style="text-align:left; padding:10px;">Added</th>
                  <th style="text-align:center; padding:10px;">Status</th>
                </tr>
              </thead>
              <tbody>
                <% managers.forEach(m => { %>
                <tr style="border-bottom:1px solid var(--border);">
                  <td style="padding:10px;"><%= m.email %></td>
                  <td style="padding:10px;" class="small"><%= m.created_at ? m.created_at.split(' ')[0] : '-' %></td>
                  <td style="padding:10px; text-align:center;">
                    <% if (m.is_active) { %>
                      <span class="chip" style="background:#e8f5e9;">Active</span>
                    <% } else { %>
                      <span class="chip" style="background:#ffebee;">Inactive</span>
                    <% } %>
                  </td>
                </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } %>
      <% } %>

      <!-- SETTINGS TAB -->
      <% if (activeTab === 'settings') { %>
        
          <!-- Section 1: Basic Info -->
          <div class="card pad" style="background:#fff; margin-bottom:20px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
              <h3 style="margin:0; color:var(--primary);">1. Workplace Details</h3>
            </div>
            
            <div id="detailsDisplay">
              <div style="display:grid; grid-template-columns: 1fr 1fr; gap:14px;">
                <div><div class="small muted">Name</div><div><%= workplace.name || '-' %></div></div>
                <div><div class="small muted">Address</div><div><%= workplace.address || '-' %></div></div>
              </div>
              <div style="display:grid; grid-template-columns: 1fr 1fr; gap:14px; margin-top:14px;">
                <div><div class="small muted">Opening Time</div><div><%= workplace.open_time || '-' %></div></div>
                <div><div class="small muted">Closing Time</div><div><%= workplace.close_time || '-' %></div></div>
              </div>
              <div style="margin-top:14px;">
                <div class="small muted">Grace Period</div>
                <div><%= workplace.grace_enabled ? 'Enabled (' + (workplace.grace_minutes || 10) + ' minutes)' : 'Disabled' %></div>
              </div>
              <% if (workplace.logo_path) { %>
              <div style="margin-top:14px;">
                <div class="small muted">Logo</div>
                <img src="<%= workplace.logo_path %>" style="max-width:120px; margin-top:5px; border-radius:8px;" />
              </div>
              <% } %>
              <div class="actions" style="margin-top:15px;">
                <button type="button" class="btn primary" id="editDetailsBtn" data-workplace-id="<%= workplace.id %>">Edit Details</button>
              </div>
            </div>
          </div>

          <!-- Section 2: Location -->
          <div class="card pad" style="background:#fff; margin-bottom:20px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
              <h3 style="margin:0; color:var(--primary);">2. Location</h3>
            </div>
            
            <div id="locationDisplay">
              <% if (workplace.lat && workplace.lng) { %>
              <div style="margin-top:14px;">
                <div style="border:1px solid var(--border); border-radius:12px; overflow:hidden;">
                  <iframe
                    width="100%"
                    height="200"
                    style="border:0;"
                    loading="lazy"
                    src="https://www.google.com/maps?q=<%= workplace.lat %>,<%= workplace.lng %>&z=16&output=embed"
                  ></iframe>
                </div>
                <div class="small muted" style="margin-top:8px;">Lat: <%= workplace.lat %>, Lng: <%= workplace.lng %></div>
              </div>
              <% } else { %>
              <div class="muted small">No location set.</div>
              <% } %>
              <div class="actions" style="margin-top:15px;">
                <button type="button" class="btn primary" id="editLocBtn" data-workplace-id="<%= workplace.id %>">Edit Location</button>
              </div>
            </div>
          </div>

          <!-- Section 3: Radius -->
          <div class="card pad" style="background:#fff; margin-bottom:20px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
              <h3 style="margin:0; color:var(--primary);">3. Check-in Radius</h3>
            </div>

            <div id="radiusDisplay">
              <div><%= workplace.radius_m || 70 %> meters</div>
              <div class="small muted" style="margin-top:5px;">Allowed: 10 to 1000 meters</div>
              <div class="actions" style="margin-top:15px;">
                <button type="button" class="btn primary" id="editRadiusBtn" data-workplace-id="<%= workplace.id %>">Edit Radius</button>
              </div>
            </div>
          </div>

          <!-- Danger Zone -->
          <div class="card pad" style="background:#fff3f3; margin-top:30px;">
            <h3 style="margin:0 0 15px; color:#d32f2f;">Danger Zone</h3>
            <p class="small">Deleting will remove all employees and logs. This cannot be undone.</p>
            <button type="button" class="btn" id="deleteWorkplaceBtn" style="background:#d32f2f; color:white; margin-top:10px;" data-workplace-id="<%= workplace.id %>">Delete Workplace</button>
          </div>

          <!-- MODALS -->

          <!-- Edit Details Modal -->
          <div id="editDetailsModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
            <div class="card pad" style="background:#fff; max-width:500px; width:90%; margin:20px; max-height:90vh; overflow-y:auto;">
              <h3 style="margin:0 0 20px;">Edit Workplace Details</h3>
              <form method="post" action="/owner/workplaces/<%= workplace.id %>/settings" enctype="multipart/form-data">
                <input type="hidden" name="saveDetails" value="1" />
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:14px;">
                  <div class="field">
                    <label>Workplace Name *</label>
                    <input type="text" name="name" required value="<%= workplace.name || '' %>" />
                  </div>
                  <div class="field">
                    <label>Address</label>
                    <input type="text" name="address" value="<%= workplace.address || '' %>" placeholder="Street, City, State" />
                  </div>
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:14px; margin-top:14px;">
                  <div class="field">
                    <label>Opening Time</label>
                    <input type="text" name="open_time" data-smarttime="1" value="<%= workplace.open_time || '' %>" placeholder="e.g. 930, 1030am, 9am" />
                  </div>
                  <div class="field">
                    <label>Closing Time</label>
                    <input type="text" name="close_time" data-smarttime="1" value="<%= workplace.close_time || '' %>" placeholder="e.g. 6pm, 1800" />
                  </div>
                </div>
                <div class="field" style="margin-top:14px;">
                  <label>
                    <input type="checkbox" name="grace_enabled" value="1" <%= workplace.grace_enabled ? 'checked' : '' %> />
                    Enable grace period (<%= workplace.grace_minutes || 10 %> minutes)
                  </label>
                </div>
                <div style="margin-top:20px;">
                  <h4 style="margin:0 0 10px;">Logo</h4>
                  <% if (workplace.logo_path) { %>
                    <img src="<%= workplace.logo_path %>" style="max-width:120px; margin-bottom:10px; border-radius:8px;" />
                  <% } %>
                  <div class="field">
                    <label>Update Logo (optional)</label>
                    <input type="file" name="logo" accept="image/png,image/jpeg,image/webp" />
                    <div class="small">Leave empty to keep current logo</div>
                  </div>
                </div>
                <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:20px;">
                  <button type="button" class="btn" id="cancelEditDetailsBtn">Cancel</button>
                  <button type="submit" class="btn primary">Save Changes</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Edit Location Modal -->
          <div id="editLocationModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
            <div class="card pad" style="background:#fff; max-width:500px; width:90%; margin:20px; max-height:90vh; overflow-y:auto;">
              <h3 style="margin:0 0 20px;">Edit Location</h3>
              
              <div class="actions" style="margin-top:0; gap:10px; display:flex; flex-wrap:wrap; margin-bottom:14px;">
                <button class="btn" type="button" id="modalBtnUseLoc" style="width:auto;">Use my current location</button>
                <a class="btn" href="https://www.google.com/maps" target="_blank" rel="noreferrer" style="width:auto;">Open Google Maps</a>
              </div>

              <div id="modalLocStatus" class="notice" style="margin-bottom:14px;"></div>

              <form method="post" action="/owner/workplaces/<%= workplace.id %>/settings">
                <input type="hidden" name="saveLocation" value="1" />
                <input type="hidden" name="name" value="<%= workplace.name %>" />
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:14px;">
                  <div class="field">
                    <label>Latitude</label>
                    <input type="number" step="any" name="lat" id="modalLat" value="<%= workplace.lat || '' %>" data-radius="<%= workplace.radius_m || 70 %>" data-workplace-name="<%= workplace.name %>" />
                  </div>
                  <div class="field">
                    <label>Longitude</label>
                    <input type="number" step="any" name="lng" id="modalLng" value="<%= workplace.lng || '' %>" />
                  </div>
                </div>

                <div style="margin-top:14px;">
                  <div style="border:1px solid var(--border); border-radius:12px; overflow:hidden;">
                    <iframe
                      id="modalMapFrame"
                      width="100%"
                      height="200"
                      style="border:0;"
                      loading="lazy"
                      src="https://www.google.com/maps?q=<%= workplace.lat || 0 %>,<%= workplace.lng || 0 %>&z=16&output=embed"
                    ></iframe>
                  </div>
                </div>

                <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:20px;">
                  <button type="button" class="btn" id="cancelEditLocBtn">Cancel</button>
                  <button type="submit" class="btn primary">Save Location</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Edit Radius Modal -->
          <div id="editRadiusModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
            <div class="card pad" style="background:#fff; max-width:400px; width:90%; margin:20px;">
              <h3 style="margin:0 0 20px;">Edit Check-in Radius</h3>
              <form method="post" action="/owner/workplaces/<%= workplace.id %>/settings">
                <input type="hidden" name="saveRadius" value="1" />
                <input type="hidden" name="name" value="<%= workplace.name %>" />
                <input type="hidden" name="lat" value="<%= workplace.lat || '' %>" />
                <input type="hidden" name="lng" value="<%= workplace.lng || '' %>" />
                <div class="field">
                  <label>Radius (meters)</label>
                  <input type="number" name="radius_m" min="10" max="1000" value="<%= workplace.radius_m || 70 %>" />
                  <div class="small">Allowed: 10 to 1000 meters</div>
                </div>
                <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:20px;">
                  <button type="button" class="btn" id="cancelEditRadiusBtn">Cancel</button>
                  <button type="submit" class="btn primary">Save Radius</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Delete Workplace Modal -->
          <div id="deleteWorkplaceModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
            <div class="card pad" style="background:#fff; max-width:400px; width:90%; margin:20px;">
              <h3 style="margin:0 0 15px; color:#d32f2f;">Delete Workplace</h3>
              <p class="small">This will permanently delete all employees, attendance logs, and manager assignments. This cannot be undone.</p>
              <p class="small" style="margin-top:15px;"><strong>Workplace:</strong> <%= workplace.name %></p>
              <form method="post" action="/owner/workplaces/<%= workplace.id %>/delete" style="margin-top:20px;">
                <button type="submit" class="btn full" style="background:#d32f2f; color:white;">Yes, Delete Workplace</button>
              </form>
              <div style="margin-top:10px;">
                <button type="button" class="btn full" id="cancelDeleteBtn">Cancel</button>
              </div>
            </div>
          </div>

          </div>
      <% } %>

      </div>
    </div>
  </div>
</section>

<style>
.tab {
  display:block;
  padding:14px 20px;
  text-decoration:none;
  color:var(--muted);
  border-left:3px solid transparent;
  font-weight:500;
  transition:all 0.15s ease;
}
.tab:hover {
  background:#f0f0f0;
  color:var(--text);
}
.tab.active {
  color:var(--primary);
  border-left-color:var(--primary);
  background:#fff;
}

/* Remove underline from buttons */
.btn:hover,
button:hover {
  text-decoration: none;
}

/* Period Card Styling */
.period-card {
  display:flex;
  align-items:flex-start;
  gap:12px;
  cursor:pointer;
  padding:16px;
  border:2px solid var(--border);
  border-radius:12px;
  background:#fff;
  transition:all 0.2s ease;
}
.period-card:hover {
  border-color:var(--primary);
  background:#f8f9fa;
}
.period-card input[type="radio"] {
  margin-top:2px;
  width:18px;
  height:18px;
  accent-color:var(--primary);
}
.period-card:has(input:checked) {
  border-color:var(--primary);
  background:#f0f7ff;
}
.period-card-content {
  flex:1;
}
.period-title {
  font-weight:600;
  color:var(--text);
  margin-bottom:4px;
}
.period-desc {
  font-size:13px;
  color:var(--muted);
}

@media (max-width:768px) {
  .dashboard-layout {
    flex-direction:column;
  }
  .tab-sidebar {
    width:100% !important;
    border-right:none !important;
    border-bottom:1px solid var(--border);
    display:flex;
    flex-wrap:wrap;
  }
  .tab {
    flex:1;
    min-width:100px;
    padding:12px 15px;
    text-align:center;
    border-left:none;
    border-bottom:3px solid transparent;
  }
  .tab.active {
    border-left-color:transparent;
    border-bottom-color:var(--primary);
  }
  .period-card {
    padding:12px;
  }
}
</style>

<!-- Employee Details Modal -->
<div id="employeeModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
  <div class="card pad" style="background:#fff; max-width:400px; width:90%; margin:20px;">
    <h3 style="margin:0 0 20px;">Employee Details</h3>
    
    <div class="field">
      <label>Email</label>
      <div id="empModalEmail" style="padding:10px; background:#f5f5f5; border-radius:8px;"></div>
    </div>
    
    <div class="field" style="margin-top:16px;">
      <label>Status</label>
      <div id="empModalStatus" style="padding:10px; background:#f5f5f5; border-radius:8px;"></div>
    </div>
    
    <div class="field" style="margin-top:16px;">
      <label>Device</label>
      <div id="empModalDevice" style="padding:10px; background:#f5f5f5; border-radius:8px;"></div>
    </div>
    
    <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:20px;">
      <button type="button" class="btn" id="closeEmpModalBtn">Close</button>
    </div>
  </div>
</div>

<!-- Add Employee Modal -->
<div id="addEmployeeModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
  <div class="card pad" style="background:#fff; max-width:450px; width:90%; margin:20px; border:2px solid #1b1b1b; border-radius:12px; box-shadow:4px 4px 0 rgba(0,0,0,0.2);">
    <div style="border-bottom:1px dashed rgba(0,0,0,0.2); padding-bottom:16px; margin-bottom:16px;">
      <div style="font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; color:#6b7280; margin-bottom:8px;">Employees</div>
      <h3 style="margin:0; color:#1b1b1b;">Add Employee</h3>
      <div class="small" style="margin-top:6px; color:#6b7280;">Workplace: <b><%= workplace.name %></b></div>
    </div>

    <form class="form" method="post" action="/owner/workplaces/<%= workplace.id %>/employees" id="addEmployeeForm">
      <div class="field" style="margin-bottom:16px;">
        <label style="font-weight:600; color:#1b1b1b; margin-bottom:6px; display:block;">Employee Email</label>
        <input type="email" name="email" required placeholder="staff@example.com" style="width:100%; padding:10px; border:2px solid #1b1b1b; border-radius:8px; font-size:14px;" />
      </div>

      <div class="notice" style="background:#eaf6f0; border:2px solid #1b1b1b; border-radius:8px; padding:12px; margin-bottom:16px;">
        <div style="font-weight:700; color:#1b1b1b; margin-bottom:4px;">Check-in method</div>
        <div class="small" style="color:#4b5563;">Employees will check in using their logged-in account and GPS location.</div>
      </div>

      <div style="display:flex; gap:10px;">
        <button type="button" class="btn" id="cancelAddEmployeeBtn" style="flex:1; background:#f3f4f6; color:#1b1b1b; border:2px solid #1b1b1b; box-shadow:2px 2px 0 #1b1b1b; font-weight:700;">Cancel</button>
        <button type="submit" class="btn primary" style="flex:1; background:#10b981; color:#1b1b1b; border:2px solid #1b1b1b; box-shadow:2px 2px 0 #1b1b1b; font-weight:700;">Add Employee</button>
      </div>
    </form>
  </div>
</div>

<script src="/client/utils/employee-modal.js" defer></script>

<script src="/client/utils/workplace_location_edit.js" defer></script>
<script src="/client/utils/smart_time_12h.js" defer></script>
<script src="/client/utils/workplace_location.js" defer></script>
<script src="/client/utils/save_logs_modal.js" defer></script>
