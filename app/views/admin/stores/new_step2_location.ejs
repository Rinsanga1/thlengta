<header class="nav">
  <div class="container nav-inner">
    <div class="brand">
      <span>
        <img src="/assets/img/thlengtalogo.png" alt="Thlengta logo" width="80px"/>
      </span>
      <span class="small">
        <img src="/assets/img/thlengtalogotext.png" alt="Thlengta logo type" width="195px"/>
      </span>
      <span class="small">
        <img src="/assets/img/com.png" alt="Thlengta logo type" width="75px" style="margin-left: -10px"/>
      </span>
    </div>
    <nav class="nav-links">
      <a class="btn" href="/admin/stores/new/step-1">Back</a>
    </nav>
  </div>
</header>

<section class="section" style="padding-top:46px;">
  <div class="card pad super" style="max-width:980px;margin:0 auto;">
    <div class="topbar" style="margin-bottom:14px;">
      <div>
        <div class="h-eyebrow">
          <span class="chip">Workplace</span>
          <span class="chip">Setup</span>
          <span class="chip">Step 2 of 4</span>
        </div>
        <h2 style="margin:10px 0 0;">Workplace location</h2>
        <div class="small" style="margin-top:6px;">
          If you are at the workplace, use your current location. Otherwise, add coordinates manually.
        </div>
      </div>
    </div>

    <% if (error) { %>
      <div class="error"><%= error %></div>
    <% } %>

    <!-- Card 1: Current location + preview -->
    <div class="card pad" style="background:#fff;">
      <h3 style="margin:0 0 10px;">Are you at the workplace location?</h3>

      <div class="small" style="margin:0 0 10px;">
        Click the button, allow location permission, then confirm the map preview.
      </div>

      <div style="display:grid; grid-template-columns: 1.2fr 0.8fr; gap:14px; align-items:start;">
        <!-- Left: actions + status + continue -->
        <div>
          <div class="actions" style="margin-top:0; gap:10px; display:flex; flex-wrap:wrap;">
            <button class="btn primary" type="button" id="btnUseLoc" style="width:auto;">Use my current location</button>
            <a class="btn" href="https://www.google.com/maps" target="_blank" rel="noreferrer" style="width:auto;">Open Google Maps</a>
          </div>

          <div id="locStatus" class="notice" style="margin-top:12px;background:#fff7df;">
            <div style="font-weight:900;">Not set yet</div>
            <div class="small" style="margin-top:6px;">
              After allowing location, we will show your coordinates here.
            </div>
          </div>

          <form class="form" method="post" action="/admin/stores/new/step-2" style="margin-top:12px;">
            <input type="hidden" name="lat" id="lat" />
            <input type="hidden" name="lng" id="lng" />
            <input type="hidden" name="accuracy_m" id="acc" />

            <div class="actions" style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
              <button class="btn primary" type="submit" id="btnContinue" disabled style="width:auto;">Continue</button>
              <a class="btn" href="/admin/stores/new/step-1" style="width:auto;">Back</a>
            </div>

            <div class="small" style="margin-top:10px; color:var(--muted);">
              Tip: if “Continue” stays disabled, make sure location permission is allowed.
            </div>
          </form>
        </div>

        <!-- Right: map preview -->
        <div class="card pad" style="background:#f8faf9;">
          <h3 style="margin:0 0 10px;">Map preview</h3>
          <div class="small" style="margin:0 0 10px;">
            This is only a preview, your saved location comes from the coordinates.
          </div>

          <div style="border:1px solid var(--border); border-radius:12px; overflow:hidden;">
            <iframe
              id="mapFrame"
              title="Map preview"
              width="100%"
              height="260"
              style="border:0;display:block;"
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              src="https://www.google.com/maps?q=23.000000,92.000000&z=16&output=embed"
            ></iframe>
          </div>

          <div class="small" style="margin-top:10px;">
            Tip: GPS indoors can be slightly off. You will set radius next.
          </div>
        </div>
      </div>

      <!-- Mobile stacking -->
      <style>
        @media (max-width: 820px){
          .card.pad.super > .card.pad[style*="background:#fff;"] > div[style*="grid-template-columns"]{
            grid-template-columns: 1fr !important;
          }
          /* make iframe a bit taller on mobile */
          #mapFrame{ height: 280px; }
        }
      </style>
    </div>

    <div style="height:14px;"></div>

    <!-- Card 2: Manual input -->
    <div class="card pad" style="background:#fff;">
      <h3 style="margin:0 0 10px;">Not at the workplace location?</h3>
      <div class="small" style="margin:0 0 12px;">
        You can manually add latitude and longitude. Best method: open Google Maps, press and hold the location pin, then copy the numbers.
      </div>

      <div class="actions" style="margin-top:0; display:flex; flex-wrap:wrap; gap:10px;">
        <button class="btn" type="button" id="btnManual" style="width:auto;">Manually add location</button>
      </div>

      <form class="form" id="manualForm" method="post" action="/admin/stores/new/step-2" style="display:none;margin-top:12px;">
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:14px;">
          <div class="field">
            <label>Latitude</label>
            <input type="number" step="any" name="lat" placeholder="23.7271" required />
          </div>

          <div class="field">
            <label>Longitude</label>
            <input type="number" step="any" name="lng" placeholder="92.7176" required />
          </div>

          <div class="field">
            <label>Accuracy (optional)</label>
            <input type="number" step="any" name="accuracy_m" placeholder="Example: 15" />
            <div class="small">Optional, from GPS, in meters.</div>
          </div>
        </div>

        <div class="actions" style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
          <button class="btn primary" type="submit" style="width:auto;">Continue</button>
        </div>

        <style>
          @media (max-width: 820px){
            /* manual fields stack on mobile */
            #manualForm > div[style*="grid-template-columns"]{
              grid-template-columns: 1fr !important;
            }
          }
        </style>
      </form>
    </div>
  </div>
</section>

<script src="/client/utils/workplace_step2.js" defer></script>
