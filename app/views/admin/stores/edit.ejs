<header class="nav">
  <div class="container nav-inner">
    <div class="brand">
      <span>
        <img src="/assets/img/thlengtalogo.png" alt="Thlengta logo" width="80px"/>
      </span>
      <span class="small">
        <img src="/assets/img/thlengtalogotext.png" atl="Thlengta logo type" width="195px"/>
      </span>
      <span class="small">
        <img src="/assets/img/com.png" atl="Thlengta logo type" width="75px" style="margin-left: -10px"/>
      </span>
    </div>

    <nav class="nav-links">
      <a class="btn" href="/admin/dashboard">Back</a>
    </nav>
  </div>
</header>

<!---Below is the fucntional stuff -->
<section class="section" style="padding-top:46px;">
  <div class="card pad super" style="max-width:1100px;margin:0 auto;">
    <div class="topbar" style="margin-bottom:14px;">
      <div>
        <div class="h-eyebrow">
          <span class="chip">Store</span>
          <span class="chip">Settings</span>
        </div>
        <h2 style="margin:10px 0 0;">Store Settings</h2>
        <div class="small" style="margin-top:6px;">
          Store: <b><%= store.name %></b>
        </div>
      </div>
    </div>

    <% if (message) { %>
      <div class="notice" style="margin:12px 0; background:#eaf6f0;">
        <div style="font-weight:900;">Saved</div>
        <div class="small" style="margin-top:6px;"><%= message %></div>
      </div>
    <% } %>

    <% if (error) { %>
      <div class="error"><%= error %></div>
    <% } %>

    <!-- Quick actions + QR info -->
    <div class="grid-3 store-grid-2" style="grid-template-columns: 1fr 1fr; gap:14px;">
      <div class="card pad" style="background:#fff;">
        <h3 style="margin:0 0 8px;">QR and access</h3>
        <div class="small">Public ID: <b><%= store.public_id %></b></div>

        <div class="actions" style="margin-top:12px;">
          <a class="btn" href="/admin/store/<%= store.id %>/qr">View QR</a>
          <a class="btn" href="/admin/store/<%= store.id %>/employees">Employees</a>
          <a class="btn" href="/admin/store/<%= store.id %>/logs">Logs</a>
        </div>

        <div class="small" style="margin-top:10px;">
          If you rotate the QR, the old QR stops working instantly.
        </div>
      </div>

      <div class="card pad" style="background:#f8faf9;">
        <h3 style="margin:0 0 8px;">Exports</h3>
        <div class="small">
          Download CSV reports for a day or an entire month.
        </div>

        <div class="actions" style="margin-top:12px;">
          <a class="btn primary" href="/admin/store/<%= store.id %>/logs">Open Logs</a>
        </div>

        <div class="small" style="margin-top:10px;">
          Includes On Time / Late status (based on opening time if set).
        </div>
      </div>
    </div>

    <div style="height:14px;"></div>

    <!-- STORE LOGO -->
    <div class="card pad" style="background:#fff;">
      <h3 style="margin:0 0 10px;">Store logo</h3>

      <div class="grid-3" style="grid-template-columns: 0.7fr 1.3fr; gap:14px; align-items:start;">
        <div>
          <% if (store.logo_path) { %>
            <div style="display:flex; justify-content:center; align-items:center;">
              <div style="padding:12px; border-radius:16px; border:2px solid rgba(0,0,0,0.1); background:#fff;">
                <img
                  src="<%= store.logo_path %>"
                  alt="Store logo"
                  style="max-width:160px;max-height:160px;border-radius:14px;display:block;"
                />
              </div>
            </div>
            <div class="small" style="margin-top:10px;">
              Uploading a new logo replaces the old one.
            </div>
          <% } else { %>
            <div class="notice" style="background:#f8faf9;">
              <div style="font-weight:900;">No logo uploaded</div>
              <div class="small" style="margin-top:6px;">Optional, but recommended for QR prints.</div>
            </div>
          <% } %>
        </div>

        <div>
          <form class="form" method="post" action="/admin/store/<%= store.id %>/logo" enctype="multipart/form-data">
            <div class="field">
              <label>Upload / replace logo</label>
              <input type="file" name="logo" accept="image/png,image/jpeg,image/webp" required />
              <div class="small">PNG/JPG/WebP supported.</div>
            </div>
            <div class="actions" style="margin-top:10px;">
              <button class="btn primary" type="submit" style="width:auto;">Upload / Replace Logo</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div style="height:14px;"></div>

    <!-- STORE TIMINGS -->
<div class="card pad" style="background:#fff;">
  <h3 style="margin:0 0 10px;">Store timings</h3>
  <div class="small" style="margin:0 0 12px;">
    Opening time is used to mark attendance as <b>On Time</b> or <b>Late</b>.
  </div>

  <form class="form" method="post" action="/admin/store/<%= store.id %>/settings">

    <!-- Opening time (card) -->
    <div class="card pad" style="background:#f8faf9;">
      <h3 style="margin:0 0 10px;">Opening time</h3>
      <div class="field" style="margin:0;">
        <input
          type="time"
          name="open_time"
          value="<%= store.open_time || '' %>"
          style="max-width:360px; width:100%;"
        />
      </div>
      <div class="small" style="margin-top:8px;">
        Used for On Time / Late calculation.
      </div>
    </div>

    <div style="height:14px;"></div>

    <!-- Grace period (card) -->
    <div class="card pad" style="background:#f8faf9;">
      <label>
        <input
          type="checkbox"
          name="grace_enabled"
          value="1"
          style="margin-top:4px; flex:0 0 auto;"
          <%= store.grace_enabled ? "checked" : "" %>
        /><b>Enable 10-minute grace period</b>
      </label>
    </div>

    <div style="height:14px;"></div>

    <!-- Closing time (card) -->
    <div class="card pad" style="background:#f8faf9;">
      <h3 style="margin:0 0 10px;">Closing time</h3>
      <div class="field" style="margin:0;">
        <input
          type="time"
          name="close_time"
          value="<%= store.close_time || '' %>"
          style="max-width:360px; width:100%;"
        />
      </div>
      <div class="small" style="margin-top:8px;">
        Optional for now. Later we can use this to enforce checkout before closing.
      </div>
    </div>

    <div style="height:14px;"></div>

    <!-- Save button -->
    <div class="actions">
      <button class="btn primary" type="submit" style="width:auto;">Save Settings</button>
    </div>

  </form>
</div>

    <!-- EXPORT CSV -->
    <div class="card pad" style="background:#f8faf9;">
      <h3 style="margin:0 0 10px;">Export logs (CSV)</h3>
      <div class="small" style="margin:0 0 12px;">
        Export a day or a whole month.
      </div>

      <div class="export-grid">
        <div class="card pad" style="background:#fff;">
          <h3 style="margin:0 0 10px;">Export a day</h3>
          <form class="form" method="get" action="/admin/store/<%= store.id %>/logs.csv">
            <div class="field">
              <label>Date</label>
              <input type="date" name="date" value="<%= new Date().toISOString().slice(0,10) %>" required />
            </div>
            <div class="actions" style="margin-top:10px;">
              <button class="btn primary" type="submit" style="width:auto;">Download Day CSV</button>
            </div>
          </form>
        </div>

        <div class="card pad" style="background:#fff;">
          <h3 style="margin:0 0 10px;">Export a month</h3>
          <form class="form" method="get" action="/admin/store/<%= store.id %>/logs_month.csv">
            <div class="field">
              <label>Month</label>
              <input type="month" name="month" value="<%= new Date().toISOString().slice(0,7) %>" required />
            </div>
            <div class="actions" style="margin-top:10px;">
              <button class="btn primary" type="submit" style="width:auto;">Download Month CSV</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div style="height:14px;"></div>

    <!-- ROTATE QR -->
    <div class="card pad" style="background:#fff;">
      <h3 style="margin:0 0 10px;">Rotate QR (generate new)</h3>
      <div class="small" style="margin:0 0 12px;">
        This invalidates the old QR immediately. Print the new QR after rotating.
      </div>

      <form
        method="post"
        action="/admin/store/<%= store.id %>/qr/rotate"
        onsubmit="return confirm('Rotate QR? Old QR will stop working immediately.');"
      >
        <button class="btn" type="submit" style="width:auto;">Rotate QR</button>
      </form>
    </div>

    <div style="height:14px;"></div>

    <!-- DELETE STORE -->
    <div class="card pad" style="background:#fff1f1;">
      <h3 style="margin:0 0 10px;">Delete store</h3>
      <div class="small" style="margin:0 0 12px;">
        This removes the store and all employees/devices/logs under it.
      </div>

      <form
        method="post"
        action="/admin/store/<%= store.id %>/delete"
        onsubmit="return confirm('DELETE STORE? This cannot be undone.');"
      >
        <button class="btn" type="submit" style="width:auto; background:#fff;">
          Delete Store
        </button>
      </form>
    </div>

  </div>
</section>
